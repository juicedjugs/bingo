import{p,x as R,a as c}from"./chunk-QMGIS6GS-BQ5ZSHI-.js";import{G as O,x,y as L,b as P,z as w,A as B}from"./iconify-CZhN-2v0.js";function b(e){return e==null||Object.keys(e).length===0}function C(e){const{styles:o,defaultTheme:a={}}=e,n=typeof o=="function"?r=>o(b(r)?a:r):o;return p.jsx(O,{styles:n})}function y(e){const o=L(e);return e!==o&&o.styles?(o.styles.match(/^@layer\s+[^{]*$/)||(o.styles=`@layer global{${o.styles}}`),o):e}function N({styles:e,themeId:o,defaultTheme:a={}}){const n=x(a),r=o&&n[o]||n;let t=typeof e=="function"?e(r):e;return r.modularCssLayers&&(Array.isArray(t)?t=t.map(s=>y(typeof s=="function"?s(r):s)):t=y(t)),p.jsx(C,{styles:t})}let E=0;function G(e){const[o,a]=c.useState(e),n=e||o;return c.useEffect(()=>{o==null&&(E+=1,a(`mui-${E}`))},[o]),n}const M={...R},u=M.useId;function K(e){if(u!==void 0){const o=u();return e??o}return G(e)}function v(e){return p.jsx(N,{...e,defaultTheme:w,themeId:P})}function q(e){return function(a){return p.jsx(v,{styles:typeof e=="function"?n=>e({theme:n,...a}):e})}}function Q(){return B}const I="user_stats_cache_",_=24*60*60*1e3,$=async e=>{const o="https://corsproxy.io/?",a=`https://secure.runescape.com/m=hiscore_oldschool/index_lite.json?player=${encodeURIComponent(e)}`;return await(await fetch(`${o}${encodeURIComponent(a)}`)).json()},Z=async e=>{const o=`${I}${e.toLowerCase()}`;try{const n=localStorage.getItem(o);if(n){const r=JSON.parse(n);if(Date.now()-r.timestamp<_)return console.log(`Using cached stats for ${e}`),r.data;console.log(`Cache expired for ${e}, fetching new data`)}}catch(n){console.warn(`Error reading cache for ${e}:`,n)}console.log(`Fetching fresh stats for ${e}`);const a=await $(e);try{const n={data:a,timestamp:Date.now(),username:e.toLowerCase()};localStorage.setItem(o,JSON.stringify(n))}catch(n){console.warn(`Error caching data for ${e}:`,n)}return a},F=()=>{try{const e=Date.now(),o=[];for(let a=0;a<localStorage.length;a++){const n=localStorage.key(a);if(n&&n.startsWith(I))try{const r=localStorage.getItem(n);if(r){const t=JSON.parse(r);e-t.timestamp>=_&&o.push(n)}}catch{o.push(n)}}o.forEach(a=>localStorage.removeItem(a)),o.length>0&&console.log(`Cleared ${o.length} expired user stats cache entries`)}catch(e){console.warn("Error clearing expired user stats cache:",e)}};function ee(e){const o=D=>e.find(h=>h.name.toLowerCase()===D.toLowerCase())?.level??1,a=o("Attack"),n=o("Strength"),r=o("Defence"),t=o("Hitpoints"),s=o("Prayer"),l=o("Ranged")||o("Range"),d=o("Magic"),i=.25*(r+t+Math.floor(s/2)),m=.325*(a+n),A=.325*Math.floor(l*1.5),S=.325*Math.floor(d*1.5);return Math.floor(i+Math.max(m,A,S))}const Y={dimension:5,scale:100,openCreateTileDialog:!1,openPngExportDialog:!1,bingoBoard:Array.from({length:5**2},()=>({id:null})),editingTileId:null,creatingForBoardIndex:null,players:[],teams:[]},U="bingo-app-state",j="bingo-tile-ideas";function H(e,o){if(typeof window>"u")return o;try{const a=window.localStorage.getItem(e);return a?JSON.parse(a):o}catch(a){return console.error(`Error loading from localStorage key "${e}":`,a),o}}function J(e,o){if(!(typeof window>"u"))try{window.localStorage.setItem(e,JSON.stringify(o))}catch(a){console.error(`Error saving to localStorage key "${e}":`,a)}}function f(e,o,a,n){const[r,t]=c.useReducer(e,o),[s,l]=c.useState(!1);return c.useEffect(()=>{if(!s){const d=H(a,o),i=n?n(d,o):{...o,...d};JSON.stringify(i)!==JSON.stringify(o)&&t({type:"HYDRATE_FROM_STORAGE",payload:i}),l(!0)}},[o,a,n,s]),c.useEffect(()=>{s&&J(a,r)},[r,a,s]),[r,t]}function k(e,o){switch(o.type){case"HYDRATE_FROM_STORAGE":return o.payload;case"SET_DIMENSION":return{...e,dimension:o.payload,bingoBoard:e.bingoBoard.length===o.payload**2?e.bingoBoard:e.bingoBoard.length>o.payload**2?e.bingoBoard.slice(0,o.payload**2):[...e.bingoBoard,...Array.from({length:o.payload**2-e.bingoBoard.length},()=>({id:null}))]};case"SET_SCALE":return{...e,scale:o.payload};case"SET_OPEN_CREATE_TILE_DIALOG":return{...e,openCreateTileDialog:o.payload};case"SET_OPEN_PNG_EXPORT_DIALOG":return{...e,openPngExportDialog:o.payload};case"REORDER_BINGO_BOARD":{const{from:a,to:n}=o.payload,r=[...e.bingoBoard],[t]=r.splice(a,1);return r.splice(n,0,t),{...e,bingoBoard:r}}case"ASSIGN_TILE_IDEA_TO_BINGO_TILE":{const{tileIndex:a,tileIdeaId:n}=o.payload,r=[...e.bingoBoard];return r[a]={id:n},{...e,bingoBoard:r}}case"CLEAR_BINGO_TILE":{const{tileIndex:a}=o.payload,n=[...e.bingoBoard];return n[a]={id:null},{...e,bingoBoard:n}}case"SET_EDITING_TILE_ID":return{...e,editingTileId:o.payload};case"SET_CREATING_FOR_BOARD_INDEX":return{...e,creatingForBoardIndex:o.payload};case"CLEAR_BOARD":return{...e,bingoBoard:Array.from({length:e.dimension**2},()=>({id:null}))};case"SHUFFLE_BOARD":{const a=[...e.bingoBoard];for(let n=a.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1));[a[n],a[r]]=[a[r],a[n]]}return{...e,bingoBoard:a}}case"ADD_TEAM":return{...e,teams:[...e.teams,{name:o.payload.name}]};case"EDIT_TEAM":{const a=[...e.teams];return a[o.payload.index]={name:o.payload.name},{...e,teams:a}}case"REMOVE_TEAM":{const a=e.teams.filter((t,s)=>s!==o.payload.index),n=String(o.payload.index),r=e.players.map(t=>t.teamId===n?{...t,teamId:null}:t);return{...e,teams:a,players:r}}case"ADD_PLAYER":return{...e,players:[...e.players,{username:o.payload.username,teamId:null}]};case"EDIT_PLAYER":{const a=[...e.players];return a[o.payload.index]={...a[o.payload.index],username:o.payload.username},{...e,players:a}}case"REMOVE_PLAYER":{const a=e.players.filter((n,r)=>r!==o.payload.index);return{...e,players:a}}case"ASSIGN_PLAYER_TO_TEAM":{const a=[...e.players];return a[o.payload.playerIndex]={...a[o.payload.playerIndex],teamId:o.payload.teamId},{...e,players:a}}case"REORDER_PLAYERS_IN_TEAM":{const{teamId:a,fromIndex:n,toIndex:r}=o.payload,t=[...e.players],s=[];if(t.forEach((l,d)=>{l.teamId===a&&s.push(d)}),n<s.length&&r<s.length){const l=s[n],d=s[r],[i]=t.splice(l,1);t.splice(d,0,i)}return{...e,players:t}}default:return e}}const T=c.createContext(void 0);function oe({children:e}){const[o,a]=f(k,Y,U,(r,t)=>({...t,...r,dimension:r?.dimension&&[3,4,5,6,7].includes(r.dimension)?r.dimension:t.dimension,scale:r?.scale&&r.scale>=50&&r.scale<=200?r.scale:t.scale}));c.useEffect(()=>{F()},[]);const n={state:o,dispatch:a,setDimension:r=>{a({type:"SET_DIMENSION",payload:r})},setScale:r=>{a({type:"SET_SCALE",payload:r})},setOpenCreateTileDialog:r=>{a({type:"SET_OPEN_CREATE_TILE_DIALOG",payload:r})},setOpenPngExportDialog:r=>{a({type:"SET_OPEN_PNG_EXPORT_DIALOG",payload:r})},reorderBingoBoard:(r,t)=>{a({type:"REORDER_BINGO_BOARD",payload:{from:r,to:t}})},assignTileIdeaToBingoTile:(r,t)=>{a({type:"ASSIGN_TILE_IDEA_TO_BINGO_TILE",payload:{tileIndex:r,tileIdeaId:t}})},clearBingoTile:r=>{a({type:"CLEAR_BINGO_TILE",payload:{tileIndex:r}})},setEditingTileId:r=>{a({type:"SET_EDITING_TILE_ID",payload:r})},setCreatingForBoardIndex:r=>{a({type:"SET_CREATING_FOR_BOARD_INDEX",payload:r})},clearBoard:()=>{a({type:"CLEAR_BOARD"})},shuffleBoard:()=>{a({type:"SHUFFLE_BOARD"})},addTeam:r=>a({type:"ADD_TEAM",payload:{name:r}}),editTeam:(r,t)=>a({type:"EDIT_TEAM",payload:{index:r,name:t}}),removeTeam:r=>a({type:"REMOVE_TEAM",payload:{index:r}}),addPlayer:r=>a({type:"ADD_PLAYER",payload:{username:r}}),editPlayer:(r,t)=>a({type:"EDIT_PLAYER",payload:{index:r,username:t}}),removePlayer:r=>a({type:"REMOVE_PLAYER",payload:{index:r}}),assignPlayerToTeam:(r,t)=>a({type:"ASSIGN_PLAYER_TO_TEAM",payload:{playerIndex:r,teamId:t}}),reorderPlayersInTeam:(r,t,s)=>a({type:"REORDER_PLAYERS_IN_TEAM",payload:{teamId:r,fromIndex:t,toIndex:s}})};return p.jsx(T.Provider,{value:n,children:e})}function ae(){const e=c.useContext(T);if(e===void 0)throw new Error("useAppState must be used within a provider.");return e}function X(e,o){switch(o.type){case"ADD_TILE_IDEA":return[...e,o.payload];case"UPDATE_TILE_IDEA":return e.map(a=>a.id===o.payload.id?{...a,...o.payload}:a);case"DELETE_TILE_IDEA":return e.filter(a=>a.id!==o.payload.id);default:return e}}const g=c.createContext(void 0),z=[];function re({children:e}){const[o,a]=f(X,z,j,(l,d)=>Array.isArray(l)?l:d),n=l=>a({type:"ADD_TILE_IDEA",payload:l}),r=l=>a({type:"UPDATE_TILE_IDEA",payload:l}),t=l=>a({type:"DELETE_TILE_IDEA",payload:{id:l}}),s=c.useMemo(()=>({tileIdeas:o,addTileIdea:n,updateTileIdea:r,deleteTileIdea:t}),[o]);return p.jsx(g.Provider,{value:s,children:e})}function ne(){const e=c.useContext(g);if(!e)throw new Error("useTileIdeas must be used within a TileIdeasProvider");return e}export{N as G,oe as S,re as T,C as a,ae as b,ne as c,Z as d,ee as e,q as g,Q as i,K as u};
